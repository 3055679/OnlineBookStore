{% extends 'bookstore/base.html' %} {% block body %}
<div class="container text-center mt-5">
  <img src="https://via.placeholder.com/50" alt="Success" />
  <h2 class="mt-3">Thank you for purchasing</h2>

  <div class="mt-4" id="order-details">
    <p><b>Order ID:</b> <span id="order_id"></span></p>
    <p><b>Name:</b> <span id="order_name"></span></p>
    <p><b>Phone:</b> <span id="order_phone"></span></p>
    <p><b>Email:</b> <span id="order_email"></span></p>
    <p><b>Payment Method:</b> <span id="order_payment"></span></p>
    <p><b>Shipping Address:</b> <span id="order_address"></span></p>
  </div>

  <div class="mt-4">
    <a href="#" class="btn btn-primary">游닌 Download Invoice</a>
  </div>

  <!-- <button id="confirm-payment" class="btn btn-success w-100 mt-3">Confirm Payment</button>-->
</div>


<script>
  function updateCheckoutSummary(totalItems, subtotal) {
      document.getElementById("total-items").textContent = totalItems;
      document.getElementById("subtotal").textContent = `$ ${subtotal.toFixed(2)}`;
      document.getElementById("total_price").textContent = `$ ${(subtotal + 5).toFixed(2)}`;
  }
  </script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    let orderId = new URLSearchParams(window.location.search).get("order_id") || localStorage.getItem("order_id");

    if (!orderId || orderId === "undefined") {
        alert("丘멆잺 Error: No valid order ID found.");
        return;
    }

    console.log("游릭 Fetching Order Details for Order ID:", orderId);

    fetch("/bookstore/get_order_details/?order_id=" + orderId)
    .then(response => response.json())
    .then(data => {
        console.log("游릭 Order Details Received:", data);

        if (data.error) {
            alert("丘멆잺 Error: " + data.error);
            return;
        }

        document.getElementById("order_id").textContent = `#${data.order_id}`;
        document.getElementById("order_name").textContent = data.name;
        document.getElementById("order_email").textContent = data.email;
        document.getElementById("order_phone").textContent = data.phone;
        document.getElementById("order_payment").textContent = data.payment_method;
        document.getElementById("order_address").textContent = data.address;
    })
    .catch(error => {
        console.error("游댮 Fetch Error:", error);
        alert("Error fetching order details.");
    });
});

</script>
<script>

  function addToCart(bookId) {
      fetch(`/bookstore/add_to_cart/${bookId}/`, { method: "POST" })
          .then(response => response.json())
          .then(data => {
              if (data.success) {
                  console.log("游릭 Item added to cart:", data);
  
                
                  updateCheckoutSummary(data.total_items, data.subtotal);
              } else {
                  alert("丘멆잺 Failed to add item to cart.");
              }
          })
          .catch(error => console.error("游댮 Error adding item to cart:", error));
  }
  
  function updateCheckoutSummary(totalItems, subtotal) {
      document.getElementById("total-items").textContent = totalItems;
      document.getElementById("subtotal").textContent = `$ ${subtotal.toFixed(2)}`;
      document.getElementById("total_price").textContent = `$ ${(subtotal + 5).toFixed(2)}`;
  }
  

  document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll(".add-to-cart").forEach(button => {
          button.addEventListener("click", function () {
              let bookId = this.getAttribute("data-book-id"); 
              addToCart(bookId);
          });
      });
  });
  </script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
      document.getElementById("confirm-payment").addEventListener("click", function () {

          let orderId = localStorage.getItem("order_id");
          if (!orderId) {
              alert("丘멆잺 Error: No valid order ID found.");
              return;
          }
  
          console.log("游릭 Confirming order, Order ID:", orderId);
  
          window.location.href = "{% url 'bookstore:my_orders' %}";
      });
  });
  </script>
  
{% endblock %}
