{% extends 'bookstore/base.html' %} {% block body %}
<div class="container mt-5">
  <div class="row">
    <!-- Left side: Book Image -->
    <div class="col-md-4 text-center">
      <img
        src="{{ book.book_image }}"
        alt="{{ book.title }}"
        class="img-fluid rounded shadow-lg"
        style="max-width: 100%"
      />
    </div>

    <!-- Right side: Book Details -->
    <div class="col-md-8">
      <h2 class="fw-bold">{{ book.title }}</h2>
      <h5 class="text-muted">By {{ book.author }}</h5>
      <p class="mt-2">
        {% for _ in ""|ljust:book.rating %}‚≠ê{% endfor %} ({{ book.rating }})
      </p>      
      <h4 class="text-danger fw-bold">Price: ${{ book.price }}</h4>
      <p class="mt-3">{{ book.desc }}</p>

      <button class="btn btn-primary mt-3 add-to-cart-btn" data-book-id="{{ book.id }}">
        üõí Add to Cart 
    </button>
    
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    let addToCartBtn = document.querySelector(".add-to-cart-btn");

    if (addToCartBtn) {
        addToCartBtn.addEventListener("click", function () {
            let bookId = this.getAttribute("data-book-id");

            if (!bookId || bookId === "null") {
                console.error("Invalid bookId:", bookId);
                return;
            }

            let cart = JSON.parse(localStorage.getItem("cart")) || {};

            cart[bookId] = (cart[bookId] || 0) + 1;
            localStorage.setItem("cart", JSON.stringify(cart));

            document.getElementById("cart-count").textContent = Object.keys(cart).length;
            alert("‚úÖ Added to cart successfully!");
        });
    } else {
        console.error("üö® No Add-to-Cart Button Found!");
    }
});

</script>

<div class="container mt-4">

  <h3>Reviews</h3>
  {% if reviews %}
      {% for review in reviews %}
          <div class="card my-3">
              <div class="card-body">
                  <h5 class="card-title">
                      {{ review.user.username }} 
                      <small class="text-muted">
                          ({{ review.created_at|date:"Y-m-d H:i" }})
                      </small>
                  </h5>
                  <p class="card-text">
                      Rating: {{ review.rating }}/5
                  </p>
                  <p class="card-text">
                      {{ review.review_text }}
                  </p>
              </div>
          </div>
      {% endfor %}
  {% else %}
      <p>No reviews yet. Be the first to review!</p>
  {% endif %}
</div>
{% endblock %}
